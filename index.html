<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Enhanced prototype for assessing needs of children with disabilities in Ireland, aligned with HSE guidelines.">
    <title>Children's Disability Needs Assessment - Ireland</title>
    <style>
        /* Professional and accessible CSS - Enhanced */
        :root {
            --primary-color: #0055a4; /* HSE Blue */
            --secondary-color: #003366; /* Darker HSE Blue */
            --accent-color: #ffcc00; /* Yellow Accent */
            --text-color: #333;
            --bg-color: #f5f7fa;
            --surface-color: #fff;
            --error-color: #d32f2f;
            --success-color: #388e3c;
            --border-color: #ccc;
            --disabled-bg-color: #e0e0e0;
            --disabled-text-color: #9e9e9e;

            --font-family: 'Arial', sans-serif;
            --header-font-size: 1.8rem;
            --h2-font-size: 1.5rem;
            --body-font-size: 1rem;
            --line-height: 1.6;
            --border-radius: 4px;
            --box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            --focus-outline: 3px solid var(--accent-color);
            --focus-outline-offset: 2px;
        }

        .dark-mode {
            --primary-color: #007bff; /* Brighter blue for dark mode */
            --secondary-color: #0056b3;
            --text-color: #e0e0e0;
            --bg-color: #121212;
            --surface-color: #1e1e1e;
            --border-color: #444;
            --disabled-bg-color: #333;
            --disabled-text-color: #777;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: var(--line-height);
            margin: 0;
            transition: background-color 0.3s, color 0.3s;
        }
        header {
            background-color: var(--primary-color);
            color: #fff;
            padding: 1.5rem 1rem;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        header h1 {
            font-size: var(--header-font-size);
            margin-bottom: 0.5rem;
        }
        .header-controls {
            position: absolute;
            top: 10px;
            right: 10px;
        }
        .theme-toggle {
            background: none;
            border: 1px solid #fff;
            color: #fff;
            padding: 0.3rem 0.5rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 0.8rem;
        }
        .theme-toggle:hover {
            background-color: var(--secondary-color);
        }
        nav {
            background-color: var(--secondary-color);
            padding: 0.5rem;
        }
        nav ul {
            list-style: none;
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            flex-wrap: wrap;
        }
        nav ul li a {
            color: #fff;
            text-decoration: none;
            padding: 0.5rem 1rem;
            font-weight: bold;
            transition: background-color 0.3s, box-shadow 0.3s;
            display: inline-block;
        }
        nav ul li a:hover, nav ul li a:focus, nav ul li a.active-nav {
            background-color: var(--primary-color);
            border-radius: var(--border-radius);
            box-shadow: 0 0 0 2px var(--accent-color);
        }
        main {
            max-width: 900px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        section {
            display: none;
            background-color: var(--surface-color);
            padding: 2rem;
            border-radius: 8px;
            box-shadow: var(--box-shadow);
            margin-bottom: 2rem;
            transition: background-color 0.3s, color 0.3s;
        }
        section.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        h2 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            font-size: var(--h2-font-size);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 0.5rem;
        }
        p, ul {
            margin-bottom: 1rem;
        }
        .button, button[type="submit"] {
            display: inline-block;
            background-color: var(--primary-color);
            color: #fff;
            padding: 0.85rem 1.75rem;
            border: none;
            border-radius: var(--border-radius);
            text-decoration: none;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            font-weight: bold;
        }
        .button:hover, .button:focus, button[type="submit"]:hover, button[type="submit"]:focus {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }
        .button.secondary {
            background-color: var(--text-color);
            color: var(--bg-color);
        }
        .button.secondary:hover, .button.secondary:focus {
            background-color: var(--border-color);
            color: var(--text-color);
        }
        .button-group {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        form {
            display: flex;
            flex-direction: column;
            gap: 1.75rem;
        }
        label {
            font-weight: bold;
            margin-bottom: 0.5rem;
            display: block; /* Better spacing for inputs */
        }
        input[type="text"], input[type="number"], input[type="email"], select, textarea {
            width: 100%;
            padding: 0.85rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1rem;
            background-color: var(--surface-color);
            color: var(--text-color);
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        input:disabled, select:disabled, textarea:disabled {
            background-color: var(--disabled-bg-color);
            color: var(--disabled-text-color);
            cursor: not-allowed;
        }
        input[type="checkbox"], input[type="radio"] {
            width: auto;
            margin-right: 0.7rem;
            accent-color: var(--primary-color);
            vertical-align: middle;
        }
        textarea {
            resize: vertical;
            min-height: 120px;
        }
        .checkbox-group, .radio-group {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
        }
        .checkbox-group label, .radio-group label {
            font-weight: normal; /* Override bold for individual options */
        }
        .error {
            color: var(--error-color);
            font-size: 0.9rem;
            display: none; /* Hidden by default */
            margin-top: 0.25rem;
        }
        .success {
            color: var(--success-color);
            font-size: 0.9rem;
            margin-top: 0.25rem;
        }
        input.invalid, select.invalid, textarea.invalid, .checkbox-group.invalid {
            border-color: var(--error-color) !important; /* Ensure it overrides */
            box-shadow: 0 0 0 2px var(--error-color) !important;
        }
        ul.resources {
            list-style: none; /* Remove default disc */
            padding-left: 0;
        }
        ul.resources li {
            padding-left: 1.5rem;
            position: relative;
            margin-bottom: 0.5rem;
        }
        ul.resources li::before {
            content: '➔'; /* Custom bullet */
            position: absolute;
            left: 0;
            color: var(--primary-color);
        }
        footer {
            background-color: var(--secondary-color);
            color: #e0e0e0; /* Lighter for dark blue */
            text-align: center;
            padding: 1.5rem;
            margin-top: 2rem;
        }
        footer a {
            color: var(--accent-color);
            text-decoration: none;
            font-weight: bold;
        }
        footer a:hover {
            text-decoration: underline;
        }

        /* Accessibility enhancements */
        a:focus-visible, button:focus-visible, input:focus-visible, select:focus-visible, textarea:focus-visible {
            outline: var(--focus-outline);
            outline-offset: var(--focus-outline-offset);
            box-shadow: 0 0 0 var(--focus-outline-offset) var(--surface-color), 0 0 0 calc(var(--focus-outline-offset) + 3px) var(--accent-color); /* Double outline for contrast */
        }

        .sr-only { /* Screen Reader Only */
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Progress Bar */
        #progress-bar-container {
            width: 100%;
            background-color: var(--border-color);
            border-radius: var(--border-radius);
            margin-bottom: 1.5rem;
            overflow: hidden;
        }
        #progress-bar {
            width: 0%;
            height: 20px;
            background-color: var(--success-color);
            text-align: center;
            line-height: 20px;
            color: white;
            font-weight: bold;
            transition: width 0.5s ease-in-out;
        }

        /* Input field required indicator */
        label.required::after {
            content: " *";
            color: var(--error-color);
        }

        /* Tooltip for info icons (optional) */
        .info-icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            text-align: center;
            font-size: 12px;
            line-height: 16px;
            cursor: help;
            margin-left: 5px;
            position: relative;
        }
        .info-icon .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: var(--secondary-color);
            color: #fff;
            text-align: center;
            border-radius: var(--border-radius);
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%; /* Position above the icon */
            left: 50%;
            margin-left: -100px; /* Center the tooltip */
            opacity: 0;
            transition: opacity 0.3s;
        }
        .info-icon:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        .disclaimer-box {
            border: 2px solid var(--error-color);
            background-color: #ffebee; /* Light red */
            color: #c62828; /* Darker red text */
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1.5rem;
        }
        .dark-mode .disclaimer-box {
            background-color: #4a1c1c;
            color: #ffcdd2;
        }
        .disclaimer-box strong {
            color: var(--error-color);
        }
        .dark-mode .disclaimer-box strong {
            color: #ef9a9a;
        }
        .nav-disabled {
            opacity: 0.6;
            cursor: not-allowed !important;
            pointer-events: none; /* More robust disabling */
        }
        .nav-disabled:hover, .nav-disabled:focus { /* Prevent hover/focus styles on disabled nav link */
            background-color: var(--secondary-color) !important;
            box-shadow: none !important;
        }


        /* Responsive design */
        @media (max-width: 768px) {
            header h1 {
                font-size: 1.5rem;
            }
            .header-controls {
                position: static;
                margin-top: 0.5rem;
            }
            nav ul {
                flex-direction: column;
                text-align: center;
            }
        }
        @media (max-width: 600px) {
            main {
                margin: 1rem;
                padding: 0 0.5rem;
            }
            section {
                padding: 1.5rem;
            }
            .button, button[type="submit"] {
                width: 100%;
                padding: 1rem;
            }
            .button-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header role="banner">
        <h1>Children's Disability Needs Assessment</h1>
        <div class="header-controls">
            <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode">
                <span class="sr-only">Toggle Dark Mode</span>
                🌙 {/* Icon will be replaced by JS */}
            </button>
        </div>
        <nav role="navigation" aria-label="Main navigation">
            <ul>
                <li><a href="#home" onclick="showSection('home', this)" aria-label="Go to Home Page" class="active-nav">Home</a></li>
                <li><a href="#assessment" onclick="showSection('assessment', this)" aria-label="Start Needs Assessment">Start Assessment</a></li>
                <li><a href="#results" onclick="showSection('results', this)" aria-label="View Assessment Results (disabled)" aria-disabled="true" id="nav-results" class="nav-disabled">Results</a></li>
                <li><a href="#resources" onclick="showSection('resources', this)" aria-label="View Support Resources">Resources</a></li>
            </ul>
        </nav>
    </header>
    <main role="main">
        <!-- Home Page Section -->
        <section id="home" class="active" role="region" aria-labelledby="home-heading">
            <h2 id="home-heading">Welcome to the Needs Assessment Prototype</h2>
            <p>This interactive prototype is designed to help parents and guardians in Ireland begin to identify potential support needs for children with disabilities. It serves as a preliminary guide and aims to familiarize you with the types of information considered in the HSE's formal <a href="https://www2.hse.ie/services/disability/disability-assessment/" target="_blank" rel="noopener noreferrer">Assessment of Need (AON)</a> process under the Disability Act 2005.</p>
            <p><strong>Key Features:</strong></p>
            <ul>
                <li>Guided assessment questions.</li>
                <li>Dynamic feedback based on your inputs.</li>
                <li>Secure local saving of your progress (data stays on your device).</li>
                <li>Links to official HSE resources.</li>
            </ul>
            <p>Remember, this tool does not replace a professional assessment. The goal is to empower you with information and prepare you for discussions with healthcare professionals and <a href="https://www2.hse.ie/services/disability/childrens-services/services/overview/" target="_blank" rel="noopener noreferrer">Children's Disability Network Teams (CDNTs)</a>.</p>
            <p>Based on 2022 Census data, common disabilities in children include:</p>
            <ul class="resources">
                <li>Difficulties with learning, remembering, or concentrating</li>
                <li>Psychological or emotional conditions (affecting around 5% of the population)</li>
                <li>Challenges with basic physical activities</li>
                <li>Pain, breathing difficulties, or chronic illness (affecting around 9% of the population)</li>
                <li>Intellectual disabilities</li>
            </ul>
            <div class="button-group">
                <a href="#assessment" onclick="showSection('assessment', document.querySelector('nav a[href=\\'#assessment\\']'))" class="button" aria-label="Begin the needs assessment">Start Assessment Now</a>
            </div>
            <p style="margin-top: 1.5rem;">For official information, please visit <a href="https://www2.hse.ie/services/disability/" target="_blank" rel="noopener noreferrer">HSE Disability Services</a>.</p>
        </section>

        <!-- Assessment Page Section -->
        <section id="assessment" role="region" aria-labelledby="assessment-heading">
            <h2 id="assessment-heading">Needs Assessment Form</h2>
            <p>Please provide details about your child to help identify their support needs. Fields marked with <span style="color: var(--error-color);">*</span> are required. Your data is saved locally in your browser and not sent to any server.</p>

            <div id="progress-bar-container">
                <div id="progress-bar">0%</div>
            </div>

            <form id="assessment-form" onsubmit="handleSubmit(event)" novalidate>
                <div>
                    <label for="child-name">Child's First Name (Optional):</label>
                    <input type="text" id="child-name" name="childName" aria-describedby="child-name-desc">
                    <p id="child-name-desc" class="sr-only">Enter your child's first name or leave blank for anonymity.</p>
                </div>
                <div>
                    <label for="child-age" class="required">Child's Age (0-18):</label>
                    <input type="number" id="child-age" name="childAge" min="0" max="18" required aria-describedby="age-error">
                    <p id="age-error" class="error"></p>
                </div>
                 <div>
                    <label for="child-county" class="required">County of Residence:</label>
                    <select id="child-county" name="childCounty" required aria-describedby="county-error">
                        <option value="">Select County</option>
                        <option value="Carlow">Carlow</option><option value="Cavan">Cavan</option><option value="Clare">Clare</option>
                        <option value="Cork">Cork</option><option value="Donegal">Donegal</option><option value="Dublin">Dublin</option>
                        <option value="Galway">Galway</option><option value="Kerry">Kerry</option><option value="Kildare">Kildare</option>
                        <option value="Kilkenny">Kilkenny</option><option value="Laois">Laois</option><option value="Leitrim">Leitrim</option>
                        <option value="Limerick">Limerick</option><option value="Longford">Longford</option><option value="Louth">Louth</option>
                        <option value="Mayo">Mayo</option><option value="Meath">Meath</option><option value="Monaghan">Monaghan</option>
                        <option value="Offaly">Offaly</option><option value="Roscommon">Roscommon</option><option value="Sligo">Sligo</option>
                        <option value="Tipperary">Tipperary</option><option value="Waterford">Waterford</option><option value="Westmeath">Westmeath</option>
                        <option value="Wexford">Wexford</option><option value="Wicklow">Wicklow</option>
                    </select>
                    <p id="county-error" class="error"></p>
                </div>
                <div>
                    <label for="diagnosis" class="required">Has the child received a formal diagnosis for a disability?</label>
                    <select id="diagnosis" name="diagnosisStatus" required aria-describedby="diagnosis-error diagnosis-desc">
                        <option value="">Select</option>
                        <option value="yes">Yes</option>
                        <option value="no">No</option>
                        <option value="pending">Assessment Pending / Unsure</option>
                    </select>
                    <p id="diagnosis-desc" class="sr-only">Indicate if your child has a formal diagnosis.</p>
                    <p id="diagnosis-error" class="error"></p>
                </div>
                <div id="diagnosis-details-container" style="display: none;">
                    <label for="diagnosis-details" class="required">Please specify the diagnosis (if known):</label>
                    <input type="text" id="diagnosis-details" name="diagnosisDetails" placeholder="e.g., Autism Spectrum Disorder, ADHD, Down Syndrome" aria-describedby="diagnosis-details-error">
                    <p id="diagnosis-details-error" class="error"></p>
                </div>
                <div>
                    <label for="disability-type" class="required">Primary Area of Concern / Disability Type:</label>
                    <select id="disability-type" name="disabilityType" required aria-describedby="disability-type-error">
                        <option value="">Select Primary Concern</option>
                        <option value="autism">Autism Spectrum Disorder (ASD)</option>
                        <option value="adhd">Attention Deficit Hyperactivity Disorder (ADHD)</option>
                        <option value="intellectual">Intellectual Disability</option>
                        <option value="learning_specific">Specific Learning Difficulty (e.g., Dyslexia)</option>
                        <option value="communication_speech">Communication / Speech & Language Disorder</option>
                        <option value="physical_mobility">Physical / Mobility Impairment</option>
                        <option value="sensory_vision">Sensory Impairment - Vision</option>
                        <option value="sensory_hearing">Sensory Impairment - Hearing</option>
                        <option value="mental_health">Mental Health Condition (e.g., Anxiety, Depression)</option>
                        <option value="chronic_illness">Chronic Illness / Medical Condition</option>
                        <option value="developmental_delay">Global Developmental Delay</option>
                        <option value="multiple">Multiple Disabilities / Complex Needs</option>
                        <option value="other">Other (Please specify below)</option>
                        <option value="unsure">Unsure / Needs Assessment</option>
                    </select>
                     <p id="disability-type-error" class="error"></p>
                </div>
                 <div id="disability-type-other-container" style="display: none;">
                    <label for="disability-type-other-text" class="required">Specify other primary concern:</label>
                    <textarea id="disability-type-other-text" name="disabilityTypeOther" placeholder="Describe the primary concern" aria-describedby="disability-type-other-error"></textarea>
                    <p id="disability-type-other-error" class="error"></p>
                </div>

                <div>
                    <fieldset>
                        <legend class="required">Specific Challenges Observed (select all that apply):
                            <span class="info-icon" title="Select areas where your child faces difficulties.">i
                                <span class="tooltip-text">Select all areas where your child faces notable difficulties compared to peers.</span>
                            </span>
                        </legend>
                        <div class="checkbox-group" aria-describedby="challenges-error">
                            <label><input type="checkbox" name="challenges" value="learning_memory_concentration"> Learning, remembering, or concentrating</label>
                            <label><input type="checkbox" name="challenges" value="communication_understanding"> Communication (understanding or being understood)</label>
                            <label><input type="checkbox" name="challenges" value="social_interaction"> Social interaction and making friends</label>
                            <label><input type="checkbox" name="challenges" value="emotional_regulation"> Emotional regulation (managing feelings, behaviour)</label>
                            <label><input type="checkbox" name="challenges" value="mobility_physical"> Mobility and physical activities</label>
                            <label><input type="checkbox" name="challenges" value="self_care"> Self-care skills (dressing, feeding, hygiene)</label>
                            <label><input type="checkbox" name="challenges" value="sensory_processing"> Sensory processing (reactions to sounds, lights, textures)</label>
                            <label><input type="checkbox" name="challenges" value="play_leisure"> Play and leisure activities</label>
                            <label><input type="checkbox" name="challenges" value="other_challenges"> Other specific challenges</label>
                        </div>
                        <p id="challenges-error" class="error"></p>
                    </fieldset>
                </div>
                <div id="challenges-other-container" style="display: none;">
                     <label for="challenges-other-text" class="required">Specify other challenges:</label>
                     <textarea id="challenges-other-text" name="challengesOtherText" placeholder="Describe other specific challenges" aria-describedby="challenges-other-text-error"></textarea>
                     <p id="challenges-other-text-error" class="error"></p>
                </div>

                <div>
                    <label for="therapies" class="required">Is the child currently receiving any therapies or specialist interventions?</label>
                    <select id="therapies" name="therapiesStatus" required aria-describedby="therapies-error">
                        <option value="">Select</option>
                        <option value="yes">Yes</option>
                        <option value="no">No</option>
                        <option value="waiting_list">On a waiting list</option>
                    </select>
                    <p id="therapies-error" class="error"></p>
                </div>
                <div id="therapies-details-container" style="display: none;">
                    <label for="therapies-details-text" class="required">Details of current therapies/interventions (or those on waiting list for):</label>
                    <textarea id="therapies-details-text" name="therapiesDetailsText" placeholder="e.g., Speech therapy (HSE, weekly), Occupational Therapy (Private, fortnightly), Play therapy (Waiting list)" aria-describedby="therapies-details-text-error"></textarea>
                    <p id="therapies-details-text-error" class="error"></p>
                </div>

                <div>
                    <label for="support">Current Support Network (Optional):</label>
                    <textarea id="support" name="currentSupport" placeholder="Describe current support from family, school, SNAs, community groups, etc."></textarea>
                </div>
                <div>
                    <label for="additional-support" class="required">What are your main goals or additional support you are seeking for your child?</label>
                    <textarea id="additional-support" name="additionalSupportSought" required placeholder="e.g., Access to speech therapy, help with school inclusion, support for managing behaviour, information on financial assistance." aria-describedby="additional-support-error"></textarea>
                    <p id="additional-support-error" class="error"></p>
                </div>

                <div class="button-group">
                    <button type="submit" class="button" id="submit-assessment-button">
                        <span class="button-text">Submit Assessment</span>
                        <span class="spinner" style="display: none;">⚙️</span>
                    </button>
                    <button type="button" class="button secondary" id="clear-form-button">Clear Form & Data</button>
                </div>
            </form>
        </section>

        <!-- Results Page Section -->
        <section id="results" role="region" aria-labelledby="results-heading">
            <h2 id="results-heading">Preliminary Assessment Insights</h2>
            <div class="disclaimer-box">
                <p><strong>IMPORTANT DISCLAIMER:</strong> This is a prototype tool and its output is for informational purposes only. It <strong>does not</strong> constitute a formal Assessment of Need (AON) as defined by the Disability Act 2005. The recommendations provided are general suggestions based on your input.</p>
                <p>For an official assessment and access to HSE services, you <strong>must</strong> contact your local <a href="https://www2.hse.ie/services/disability/childrens-services/services/overview/" target="_blank" rel="noopener noreferrer">Children's Disability Network Team (CDNT)</a>. This tool can help you prepare for that conversation.</p>
            </div>
            <div id="results-summary">
                <h3>Summary of Your Input:</h3>
                <p><strong>Child's Age:</strong> <span id="summary-age"></span></p>
                <p><strong>County:</strong> <span id="summary-county"></span></p>
                <p><strong>Diagnosis Status:</strong> <span id="summary-diagnosis-status"></span></p>
                <p id="summary-diagnosis-details-para" style="display:none;"><strong>Diagnosis Details:</strong> <span id="summary-diagnosis-details"></span></p>
                <p><strong>Primary Concern:</strong> <span id="summary-disability-type"></span></p>
                <p><strong>Observed Challenges:</strong> <span id="summary-challenges"></span></p>
                <p><strong>Current Therapies:</strong> <span id="summary-therapies-status"></span></p>
                <p id="summary-therapies-details-para" style="display:none;"><strong>Therapy Details:</strong> <span id="summary-therapies-details"></span></p>
                <p><strong>Support Sought:</strong> <span id="summary-additional-support"></span></p>
            </div>
            <div id="results-content">
                <h3>Potential Next Steps & Considerations:</h3>
                <ul class="resources" id="results-list">
                    <!-- Results will be populated here by JavaScript -->
                </ul>
            </div>
            <div class="button-group">
                 <button onclick="printResults()" class="button">Print These Insights</button>
                 <a href="#assessment" onclick="showSection('assessment', document.querySelector('nav a[href=\\'#assessment\\']'))" class="button secondary">Edit Assessment</a>
                 <a href="#home" onclick="showSection('home', document.querySelector('nav a[href=\\'#home\\']'))" class="button secondary">Back to Home</a>
            </div>
        </section>

        <!-- Resources Page Section -->
        <section id="resources" role="region" aria-labelledby="resources-heading">
            <h2 id="resources-heading">Key Support Resources in Ireland</h2>
            <p>This curated list provides starting points for finding information, support, and services for children with disabilities in Ireland. Always refer to the HSE for the most current and official information.</p>
            <ul class="resources">
                <li><a href="https://www2.hse.ie/services/disability/" target="_blank" rel="noopener noreferrer">HSE Disability Services</a> - Main portal for official health services and disability support.</li>
                <li><a href="https://www2.hse.ie/services/disability/childrens-services/services/overview/" target="_blank" rel="noopener noreferrer">Children's Disability Network Teams (CDNTs)</a> - Your local point of contact for assessments (AON), information, and coordination of services.</li>
                 <li><a href="https://www2.hse.ie/services/disability/disability-assessment/" target="_blank" rel="noopener noreferrer">Assessment of Need (AON) Information</a> - Detailed explanation of the formal AON process.</li>
                <li><a href="https://www.citizensinformation.ie/en/health/disability-and-illness/" target="_blank" rel="noopener noreferrer">Citizens Information - Disability & Illness</a> - Comprehensive information on rights, entitlements, and services.</li>
                <li><a href="https://ncse.ie/for-parents" target="_blank" rel="noopener noreferrer">National Council for Special Education (NCSE)</a> - Information and support for children with special educational needs in schools.</li>
                <li><a href="https://aim.gov.ie/" target="_blank" rel="noopener noreferrer">Access and Inclusion Model (AIM)</a> - Supports for children with disabilities in pre-school.</li>
                <li><a href="https://www.gov.ie/en/organisation/department-of-children-equality-disability-integration-and-youth/" target="_blank" rel="noopener noreferrer">Department of Children, Equality, Disability, Integration and Youth</a> - Government department overseeing policy.</li>
                <li><a href="https://enableireland.ie/" target="_blank" rel="noopener noreferrer">Enable Ireland</a> - Provides services to children and adults with disabilities and their families.</li>
                <li><a href="https://downsyndrome.ie/" target="_blank" rel="noopener noreferrer">Down Syndrome Ireland</a> - Support and services for individuals with Down syndrome and their families.</li>
                <li><a href="https://autism.ie/" target="_blank" rel="noopener noreferrer">AsIAm - Ireland's National Autism Charity</a> - Advocacy and support for the Autism community.</li>
                <li><a href="https://adhdireland.ie/" target="_blank" rel="noopener noreferrer">ADHD Ireland</a> - Support and information for people affected by ADHD.</li>
                <li><a href="https://www.dyslexia.ie/" target="_blank" rel="noopener noreferrer">Dyslexia Association of Ireland</a> - Resources and support for individuals with dyslexia.</li>
                <li><a href="https://www.inclusionireland.ie/" target="_blank" rel="noopener noreferrer">Inclusion Ireland</a> - National association for people with an intellectual disability.</li>
                 <li><a href="https://www.disability-federation.ie/" target="_blank" rel="noopener noreferrer">Disability Federation of Ireland (DFI)</a> - Advocates for the rights and inclusion of people with disabilities.</li>
                <li><a href="https://www.chime.ie/" target="_blank" rel="noopener noreferrer">Chime</a> - National Charity for Deafness and Hearing Loss.</li>
                <li><a href="https://www.ncbi.ie/" target="_blank" rel="noopener noreferrer">NCBI (National Council for the Blind of Ireland)</a> - Services and support for people with sight loss.</li>
                <li><a href="https://jigsaw.ie/" target="_blank" rel="noopener noreferrer">Jigsaw</a> - National Centre for Youth Mental Health.</li>

            </ul>
            <div class="button-group">
                <a href="#home" onclick="showSection('home', document.querySelector('nav a[href=\\'#home\\']'))" class="button">Back to Home</a>
            </div>
        </section>
    </main>
    <footer role="contentinfo">
        <p>© <span id="current-year">2024</span> Children's Disability Needs Assessment Prototype. Developed for demonstration purposes. Not an official HSE service.</p>
        <p>For official support and information, always visit <a href="https://www2.hse.ie/services/disability/" target="_blank" rel="noopener noreferrer">HSE Disability Services</a>.</p>
    </footer>

    <script>
        // --- CONFIGURATION ---
        const ASSESSMENT_FORM_ID = 'assessment-form';
        const LOCAL_STORAGE_KEY = 'childrenDisabilityAssessmentData';
        const NAV_LINKS_SELECTOR = 'nav ul li a';

        // --- DOM ELEMENTS ---
        let assessmentForm;
        let progressBar;
        let themeToggleButton;
        let navResultsLink;
        // Form fields (cached for performance and easier access)
        let childAgeInput, diagnosisSelect, diagnosisDetailsContainer, diagnosisDetailsInput;
        let disabilityTypeSelect, disabilityTypeOtherContainer, disabilityTypeOtherText;
        let challengesCheckboxes, challengesOtherCheckbox, challengesOtherContainer, challengesOtherText;
        let therapiesSelect, therapiesDetailsContainer, therapiesDetailsText;
        let requiredFields = [];

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            assessmentForm = document.getElementById(ASSESSMENT_FORM_ID);
            progressBar = document.getElementById('progress-bar');
            themeToggleButton = document.getElementById('theme-toggle');
            navResultsLink = document.getElementById('nav-results');

            // Cache form field elements
            childAgeInput = document.getElementById('child-age');
            diagnosisSelect = document.getElementById('diagnosis');
            diagnosisDetailsContainer = document.getElementById('diagnosis-details-container');
            diagnosisDetailsInput = document.getElementById('diagnosis-details');

            disabilityTypeSelect = document.getElementById('disability-type');
            disabilityTypeOtherContainer = document.getElementById('disability-type-other-container');
            disabilityTypeOtherText = document.getElementById('disability-type-other-text');

            challengesCheckboxes = assessmentForm.querySelectorAll('input[name="challenges"]');
            challengesOtherCheckbox = assessmentForm.querySelector('input[name="challenges"][value="other_challenges"]');
            challengesOtherContainer = document.getElementById('challenges-other-container');
            challengesOtherText = document.getElementById('challenges-other-text');

            therapiesSelect = document.getElementById('therapies');
            therapiesDetailsContainer = document.getElementById('therapies-details-container');
            therapiesDetailsText = document.getElementById('therapies-details-text');

            document.getElementById('current-year').textContent = new Date().getFullYear();

            // Identify all initially required fields
            if (assessmentForm) {
                requiredFields = Array.from(assessmentForm.querySelectorAll('[required]'));
            }


            initializeState();
            setupEventListeners();
            showSection('home', document.querySelector('nav a[href="#home"]')); // Show home section by default
        });

        function initializeState() {
            // Theme
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                themeToggleButton.innerHTML = '☀️ <span class="sr-only">Toggle Light Mode</span>';
            } else {
                themeToggleButton.innerHTML = '🌙 <span class="sr-only">Toggle Dark Mode</span>';
            }

            // Form data
            loadFormData();
            updateProgressBar(); // Update progress bar based on loaded data
            handleDynamicFieldsVisibility(); // Set initial visibility of dynamic fields

            // Results tab state
            if (localStorage.getItem(LOCAL_STORAGE_KEY + '_submitted')) {
                enableResultsTab();
            } else {
                disableResultsTab();
            }
        }

        function setupEventListeners() {
            // Theme toggle
            if (themeToggleButton) {
                themeToggleButton.addEventListener('click', toggleTheme);
            }


            // Form input/change listeners for dynamic fields, progress bar, and local storage
            if (assessmentForm) {
                assessmentForm.addEventListener('input', handleFormInteraction);
                assessmentForm.addEventListener('change', handleFormInteraction); // For select, checkbox, radio

                // Specific listeners for dynamic fields
                if(diagnosisSelect) diagnosisSelect.addEventListener('change', handleDynamicFieldsVisibility);
                if(disabilityTypeSelect) disabilityTypeSelect.addEventListener('change', handleDynamicFieldsVisibility);
                if(challengesOtherCheckbox) challengesOtherCheckbox.addEventListener('change', handleDynamicFieldsVisibility);
                if(therapiesSelect) therapiesSelect.addEventListener('change', handleDynamicFieldsVisibility);

                const clearButton = document.getElementById('clear-form-button');
                if (clearButton) clearButton.addEventListener('click', clearFormAndData);

                 // Prevent form submission if fields are invalid (browser validation might not catch all custom logic)
                assessmentForm.addEventListener('submit', event => {
                    if (!validateForm()) {
                        event.preventDefault(); // Stop submission
                        console.warn("Form validation failed. Submission prevented.");
                    }
                });
            }

        }

        function handleFormInteraction(event) {
            saveFormData();
            updateProgressBar();
            if (event.target.name && event.target.offsetParent !== null) { // If the target has a name and is visible, validate it
                validateField(event.target);
            }
        }


        // --- NAVIGATION ---
        function showSection(sectionId, navLinkElement = null) {
            document.querySelectorAll('main section').forEach(section => {
                section.classList.remove('active');
                section.setAttribute('aria-hidden', 'true');
            });
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
                targetSection.setAttribute('aria-hidden', 'false');
                targetSection.focus(); // Focus the section for screen readers
            }

            document.querySelectorAll(NAV_LINKS_SELECTOR).forEach(link => {
                link.classList.remove('active-nav');
                link.removeAttribute('aria-current');
            });
            if (navLinkElement && !navLinkElement.classList.contains('nav-disabled')) {
                navLinkElement.classList.add('active-nav');
                navLinkElement.setAttribute('aria-current', 'page');
            } else { // Fallback if navLinkElement not passed or if it was disabled
                const activeNavLink = document.querySelector(`nav ul li a[href="#${sectionId}"]`);
                if (activeNavLink && !activeNavLink.classList.contains('nav-disabled')) {
                    activeNavLink.classList.add('active-nav');
                    activeNavLink.setAttribute('aria-current', 'page');
                }
            }
            window.scrollTo(0, 0);
        }

        // --- THEME ---
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDarkMode = document.body.classList.contains('dark-mode');
            localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
            themeToggleButton.innerHTML = isDarkMode ? '☀️ <span class="sr-only">Toggle Light Mode</span>' : '🌙 <span class="sr-only">Toggle Dark Mode</span>';
            themeToggleButton.setAttribute('aria-label', isDarkMode ? 'Activate light mode' : 'Activate dark mode');
        }

        // --- FORM HANDLING & LOCAL STORAGE ---
        function saveFormData() {
            if (!assessmentForm) return;
            const formData = new FormData(assessmentForm);
            const data = Object.fromEntries(formData.entries());
            // Handle checkboxes explicitly as FormData only includes checked ones
            data.challenges = Array.from(assessmentForm.querySelectorAll('input[name="challenges"]:checked')).map(cb => cb.value);
            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(data));
        }

        function loadFormData() {
            if (!assessmentForm) return;
            const savedData = localStorage.getItem(LOCAL_STORAGE_KEY);
            if (savedData) {
                const data = JSON.parse(savedData);
                for (const key in data) {
                    if (data.hasOwnProperty(key)) {
                        const element = assessmentForm.elements[key];
                        if (element) {
                            if (key === 'challenges') { // Handle checkboxes
                                (data[key] || []).forEach(value => {
                                    const checkbox = assessmentForm.querySelector(`input[name="challenges"][value="${value}"]`);
                                    if (checkbox) checkbox.checked = true;
                                });
                            } else if (element.type === 'radio') {
                                // For radio buttons, FormData stores the value of the selected one.
                                // Need to find and check the correct radio button by its value.
                                const radioToSelect = assessmentForm.querySelector(`input[name="${key}"][value="${data[key]}"]`);
                                if (radioToSelect) radioToSelect.checked = true;
                            } else if (element.nodeName === 'SELECT') {
                                element.value = data[key];
                            }
                            else {
                                element.value = data[key];
                            }
                        }
                    }
                }
            }
        }

        function clearFormAndData() {
            if (confirm("Are you sure you want to clear all entered data? This cannot be undone.")) {
                if (assessmentForm) assessmentForm.reset();
                localStorage.removeItem(LOCAL_STORAGE_KEY);
                localStorage.removeItem(LOCAL_STORAGE_KEY + '_submitted'); // Clear submission flag
                updateProgressBar();
                handleDynamicFieldsVisibility(); // Reset dynamic fields visibility
                disableResultsTab();
                // Clear all error messages
                document.querySelectorAll('.error').forEach(err => {
                    err.style.display = 'none';
                    err.textContent = ''; // Clear text content
                });
                document.querySelectorAll('.invalid').forEach(el => el.classList.remove('invalid'));
                showSection('assessment', document.querySelector('nav a[href="#assessment"]'));
            }
        }

        // --- DYNAMIC FORM FIELD VISIBILITY ---
        function handleDynamicFieldsVisibility() {
            // Diagnosis Details
            const showDiagnosisDetails = diagnosisSelect && diagnosisSelect.value === 'yes';
            if (diagnosisDetailsContainer) diagnosisDetailsContainer.style.display = showDiagnosisDetails ? 'block' : 'none';
            if (diagnosisDetailsInput) diagnosisDetailsInput.required = showDiagnosisDetails;

            // "Other" Disability Type
            const showDisabilityTypeOther = disabilityTypeSelect && disabilityTypeSelect.value === 'other';
            if (disabilityTypeOtherContainer) disabilityTypeOtherContainer.style.display = showDisabilityTypeOther ? 'block' : 'none';
            if (disabilityTypeOtherText) disabilityTypeOtherText.required = showDisabilityTypeOther;

            // "Other" Challenges
            const showChallengesOther = challengesOtherCheckbox && challengesOtherCheckbox.checked;
            if(challengesOtherContainer) challengesOtherContainer.style.display = showChallengesOther ? 'block' : 'none';
            if(challengesOtherText) challengesOtherText.required = showChallengesOther;

            // Therapies Details
            const showTherapiesDetails = therapiesSelect && (therapiesSelect.value === 'yes' || therapiesSelect.value === 'waiting_list');
            if(therapiesDetailsContainer) therapiesDetailsContainer.style.display = showTherapiesDetails ? 'block' : 'none';
            if(therapiesDetailsText) therapiesDetailsText.required = showTherapiesDetails;

            updateProgressBar(); // Recalculate progress as required fields might change
        }

        // --- PROGRESS BAR ---
        function updateProgressBar() {
            if (!assessmentForm || !progressBar) return;

            const allVisibleFields = Array.from(assessmentForm.elements).filter(el => el.name && (el.type !== 'hidden' && el.type !== 'submit' && el.type !== 'button' && el.type !== 'reset') && el.offsetParent !== null); // only visible fields
            const currentVisibleRequiredFields = allVisibleFields.filter(field => field.required);


            if (currentVisibleRequiredFields.length === 0) {
                progressBar.style.width = '0%';
                progressBar.textContent = '0%';
                return;
            }

            // Count distinct "questions" that are required and visible
            let distinctRequiredQuestions = new Set();
            currentVisibleRequiredFields.forEach(field => {
                if (field.name === 'challenges' && field.closest('fieldset')?.querySelector('legend.required')) {
                    distinctRequiredQuestions.add('challenges_group');
                } else {
                    distinctRequiredQuestions.add(field.name);
                }
            });

            let filledDistinctQuestions = 0;
            distinctRequiredQuestions.forEach(name => {
                if (name === 'challenges_group') {
                    if (Array.from(assessmentForm.querySelectorAll('input[name="challenges"]:checked')).length > 0) {
                        filledDistinctQuestions++;
                    }
                } else {
                    const element = assessmentForm.elements[name];
                    if (element) {
                         if (element.nodeName === 'SELECT' && element.value !== "") {
                            filledDistinctQuestions++;
                        } else if (element.type === 'radio' && assessmentForm.elements[name].value) { // Radio group
                             filledDistinctQuestions++;
                        } else if (element.type !== 'radio' && element.value && element.value.trim() !== '') { // Text, number, textarea etc.
                            filledDistinctQuestions++;
                        }
                    }
                }
            });

            const progress = distinctRequiredQuestions.size > 0 ? (filledDistinctQuestions / distinctRequiredQuestions.size) * 100 : 0;
            progressBar.style.width = `${Math.round(progress)}%`;
            progressBar.textContent = `${Math.round(progress)}%`;
        }


        // --- VALIDATION ---
        function validateField(field) {
            let isValid = true;
            const errorElementId = field.name === 'challenges' ? 'challenges-error' : (field.getAttribute('aria-describedby') || `${field.id}-error`);
            const errorElement = document.getElementById(errorElementId);


            const fieldLabelElement = document.querySelector(`label[for="${field.id}"]`) || field.closest('fieldset')?.querySelector('legend');
            const fieldName = fieldLabelElement ? fieldLabelElement.textContent.replace(/\s*\*/, '').replace(/\(.*\)/, '').trim() : field.name;


            if (field.required && field.offsetParent !== null) { // Check if field is visible
                if (field.type === "checkbox" && field.name !== "challenges") { // Individual required checkbox (not part of a group like 'challenges')
                     isValid = field.checked;
                     if (!isValid && errorElement) showError(field, `This field is required.`, errorElement);
                } else if (field.type === "select-one" && field.value === "") {
                    isValid = false;
                    if (errorElement) showError(field, `Please select an option for ${fieldName}.`, errorElement);
                } else if (field.type === "number") {
                    const val = parseInt(field.value);
                    const min = parseInt(field.min);
                    const max = parseInt(field.max);
                    if (field.value === "" || (!isNaN(min) && val < min) || (!isNaN(max) && val > max)) {
                        isValid = false;
                        if (errorElement) showError(field, `Please enter a valid ${fieldName.toLowerCase()} (between ${field.min} and ${field.max}).`, errorElement);
                    }
                } else if (field.name !== "challenges" && (!field.value || field.value.trim() === "")) { // Text, textarea, etc. but not the challenges group itself
                    isValid = false;
                    if (errorElement) showError(field, `Please enter ${fieldName.toLowerCase()}.`, errorElement);
                }
            }

            // Specific validations not covered by 'required' (or for non-empty fields)
            if (field.id === 'child-age' && field.value !== "" && (parseInt(field.value) < 0 || parseInt(field.value) > 18)) {
                isValid = false;
                if (errorElement) showError(field, 'Child\'s age must be between 0 and 18.', errorElement);
            }

            if (isValid && errorElement) {
                clearError(field, errorElement);
            } else if (!isValid && field.offsetParent === null && errorElement) {
                // If an invalid field is hidden, clear its error because it's no longer effectively required.
                clearError(field, errorElement);
                isValid = true;
            }
            return isValid;
        }

        function validateForm() {
            let isFormValid = true;
            handleDynamicFieldsVisibility(); // Ensure 'required' status is up-to-date for dynamic fields

            const elementsToValidate = Array.from(assessmentForm.elements)
                .filter(el => el.name && el.required && el.offsetParent !== null &&
                              (el.type !== 'hidden' && el.type !== 'submit' &&
                               el.type !== 'button' && el.type !== 'reset'));

            elementsToValidate.forEach(field => {
                if (!validateField(field)) {
                    isFormValid = false;
                }
            });

            // Validate checkbox group 'challenges' - at least one must be checked
            const challengesFieldset = document.querySelector('#assessment-form fieldset .checkbox-group');
            const challengesLegend = challengesFieldset?.previousElementSibling; // Assuming legend is sibling before .checkbox-group

            if (challengesLegend && challengesLegend.classList.contains('required')) {
                const challengesChecked = Array.from(assessmentForm.querySelectorAll('input[name="challenges"]:checked')).length > 0;
                const challengesErrorElement = document.getElementById('challenges-error');
                if (!challengesChecked) {
                    showError(challengesFieldset, 'Please select at least one challenge.', challengesErrorElement);
                    isFormValid = false;
                } else if (challengesErrorElement) {
                    clearError(challengesFieldset, challengesErrorElement);
                }
            }


            // If "Other" challenge is checked, its textarea must be filled (if visible and required)
            if (challengesOtherCheckbox && challengesOtherCheckbox.checked && challengesOtherText.required && challengesOtherText.offsetParent !== null && challengesOtherText.value.trim() === '') {
                const errorEl = document.getElementById('challenges-other-text-error');
                showError(challengesOtherText, 'Please specify other challenges or uncheck "Other".', errorEl);
                isFormValid = false;
            } else if (challengesOtherCheckbox && challengesOtherCheckbox.checked) {
                 const errorEl = document.getElementById('challenges-other-text-error');
                 if (errorEl) clearError(challengesOtherText, errorEl);
            }


            if (!isFormValid) {
                const firstInvalidField = assessmentForm.querySelector('.invalid, [aria-invalid="true"]');
                if (firstInvalidField) {
                    const focusTarget = (firstInvalidField.matches('input, select, textarea')) ? firstInvalidField : firstInvalidField.querySelector('input, select, textarea');
                    if (focusTarget) {
                         focusTarget.focus({preventScroll:true}); // Focus first, then scroll
                         focusTarget.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }
            }
            return isFormValid;
        }

        function showError(fieldOrGroup, message, errorElement) {
            if (errorElement) {
                errorElement.textContent = message;
                errorElement.style.display = 'block';
            }
            // Add .invalid to the field or the group's container
            const targetElement = fieldOrGroup; // fieldOrGroup is already the field or the .checkbox-group div
            targetElement.classList.add('invalid');

            // Set ARIA attributes on the actual input(s) or the group container
            if (targetElement.matches('input, select, textarea')) {
                targetElement.setAttribute('aria-invalid', 'true');
                if (errorElement) targetElement.setAttribute('aria-describedby', errorElement.id);
            } else if (targetElement.classList.contains('checkbox-group')) {
                // For a group, set aria-invalid on the group and describedby.
                // Individual checkboxes might not be invalid themselves, but the group requirement isn't met.
                targetElement.setAttribute('aria-invalid', 'true'); // Or manage this more granularly if needed
                 if (errorElement) targetElement.setAttribute('aria-describedby', errorElement.id);
            }
        }

        function clearError(fieldOrGroup, errorElement) {
            if (errorElement) {
                errorElement.textContent = '';
                errorElement.style.display = 'none';
            }
            const targetElement = fieldOrGroup;
            targetElement.classList.remove('invalid');

            if (targetElement.matches('input, select, textarea')) {
                targetElement.removeAttribute('aria-invalid');
                targetElement.removeAttribute('aria-describedby');
            } else if (targetElement.classList.contains('checkbox-group')) {
                targetElement.removeAttribute('aria-invalid');
                targetElement.removeAttribute('aria-describedby');
            }
        }


        // --- FORM SUBMISSION & RESULTS ---
        async function handleSubmit(event) {
            event.preventDefault();
            const submitButton = document.getElementById('submit-assessment-button');
            const buttonText = submitButton.querySelector('.button-text');
            const spinner = submitButton.querySelector('.spinner');

            if (!validateForm()) {
                return;
            }

            // Show processing state
            buttonText.textContent = 'Processing...';
            spinner.style.display = 'inline-block';
            submitButton.disabled = true;

            // Simulate API call / processing delay
            await new Promise(resolve => setTimeout(resolve, 700));

            const formData = new FormData(assessmentForm);
            const data = Object.fromEntries(formData.entries());
            data.challenges = Array.from(assessmentForm.querySelectorAll('input[name="challenges"]:checked')).map(cb => cb.value);

            generateResults(data);

            // Update UI
            buttonText.textContent = 'Submit Assessment';
            spinner.style.display = 'none';
            submitButton.disabled = false;

            localStorage.setItem(LOCAL_STORAGE_KEY + '_submitted', 'true');
            enableResultsTab();
            showSection('results', document.querySelector('nav a[href="#results"]'));
        }

        function generateResults(data) {
            const resultsList = document.getElementById('results-list');
            resultsList.innerHTML = ''; // Clear previous results

            // Destructure data for easier access
            const {
                childName, childAge, childCounty, diagnosisStatus, diagnosisDetails,
                disabilityType, disabilityTypeOther, challenges, challengesOtherText,
                therapiesStatus, therapiesDetailsText, currentSupport, additionalSupportSought
            } = data;

            const age = parseInt(childAge);

            // Populate summary section first
            document.getElementById('summary-age').textContent = childAge || 'N/A';
            document.getElementById('summary-county').textContent = childCounty || 'N/A';
            document.getElementById('summary-diagnosis-status').textContent = diagnosisStatus ? document.querySelector(`#diagnosis option[value="${diagnosisStatus}"]`).textContent : 'N/A';
            const summaryDiagnosisDetailsPara = document.getElementById('summary-diagnosis-details-para');
            if (diagnosisStatus === 'yes' && diagnosisDetails) {
                document.getElementById('summary-diagnosis-details').textContent = diagnosisDetails;
                summaryDiagnosisDetailsPara.style.display = 'block';
            } else {
                summaryDiagnosisDetailsPara.style.display = 'none';
            }

            let primaryConcernText = disabilityType ? document.querySelector(`#disability-type option[value="${disabilityType}"]`).textContent : 'N/A';
            if (disabilityType === 'other' && disabilityTypeOther) {
                primaryConcernText += ` (${disabilityTypeOther})`;
            }
            document.getElementById('summary-disability-type').textContent = primaryConcernText;

            const challengeLabels = challenges.map(val => {
                const labelEl = assessmentForm.querySelector(`input[name="challenges"][value="${val}"]`);
                return labelEl ? labelEl.parentElement.textContent.trim() : val;
            });
            let challengesSummaryText = challengeLabels.length > 0 ? challengeLabels.join(', ') : 'None specified';
            if (challenges.includes('other_challenges') && challengesOtherText) {
                challengesSummaryText += ` (Other: ${challengesOtherText})`;
            }
            document.getElementById('summary-challenges').textContent = challengesSummaryText;

            document.getElementById('summary-therapies-status').textContent = therapiesStatus ? document.querySelector(`#therapies option[value="${therapiesStatus}"]`).textContent : 'N/A';
            const summaryTherapiesDetailsPara = document.getElementById('summary-therapies-details-para');
            if ((therapiesStatus === 'yes' || therapiesStatus === 'waiting_list') && therapiesDetailsText) {
                document.getElementById('summary-therapies-details').textContent = therapiesDetailsText;
                summaryTherapiesDetailsPara.style.display = 'block';
            } else {
                summaryTherapiesDetailsPara.style.display = 'none';
            }
            document.getElementById('summary-additional-support').textContent = additionalSupportSought || 'N/A';


            // --- Recommendation Logic ---
            let recommendations = new Set(); // Use Set to avoid duplicate recommendation strings

            recommendations.add(`<strong>Key Considerations for a child aged ${age} in ${childCounty}:</strong>`);

            // 1. Assessment of Need (AON) - Universal Starting Point
            if (diagnosisStatus === 'no' || diagnosisStatus === 'pending' || disabilityType === 'unsure') {
                recommendations.add('It is highly recommended to apply for a formal <a href="https://www2.hse.ie/services/disability/disability-assessment/" target="_blank" rel="noopener noreferrer">Assessment of Need (AON)</a> through your local CDNT. This is the official pathway to identify needs and access many HSE supports. If you have concerns but no diagnosis, your GP can also provide guidance or a referral.');
            } else if (diagnosisStatus === 'yes') {
                let diagText = diagnosisDetails || primaryConcernText;
                diagText = diagText.replace(/\(.*\)/, '').trim(); // Clean up text like "Autism Spectrum Disorder (ASD)" to just "Autism Spectrum Disorder" for this sentence.
                recommendations.add(`With an existing diagnosis related to '${diagText}', ensure your local CDNT is fully aware and involved. If you're not already connected with them for this child, making contact is a key step for service coordination.`);
            }

            // 2. Age-Specific Advice
            if (age < 3) {
                recommendations.add('For children under 3, <strong>Early Intervention services</strong> are paramount. Your CDNT will be the main coordinator. Focus on developmental play and implementing strategies shared by therapists in daily routines. Accessing parent-infant programs can also be beneficial.');
            } else if (age >= 3 && age < 6) {
                recommendations.add('For preschool-aged children (3-5), continue with or initiate Early Intervention. Discuss preschool options with your CDNT. Explore the <a href="https://aim.gov.ie/" target="_blank" rel="noopener noreferrer">Access and Inclusion Model (AIM)</a> for support in mainstream preschools, if applicable.');
            } else if (age >= 6 && age <= 12) {
                recommendations.add('For primary school children, liaise closely with the school and the <a href="https://ncse.ie/for-parents" target="_blank" rel="noopener noreferrer">National Council for Special Education (NCSE)</a> for educational supports like Special Needs Assistants (SNAs), resource teaching hours, and assistive technology. An Individual Education Plan (IEP) should be developed in collaboration with the school.');
            } else if (age > 12) {
                recommendations.add('For teenagers, focus on <strong>transition planning</strong> for post-school options (further education, vocational training, employment supports). The NCSE and CDNT can guide this. Developing independence, life skills, and self-advocacy are key at this stage.');
            }

            // 3. Primary Disability Type / Concern
            const disabilityActions = {
                'autism': 'Explore resources from <a href="https://autism.ie/" target="_blank" rel="noopener noreferrer">AsIAm</a>. Strategies for social communication, sensory sensitivities, and predictable routines are often beneficial. Consider social skills groups.',
                'adhd': 'Look into behavioural therapies and classroom accommodations. <a href="https://adhdireland.ie/" target="_blank" rel="noopener noreferrer">ADHD Ireland</a> offers resources and support. Medication may be discussed with a relevant medical professional.',
                'intellectual': 'Connect with <a href="https://www.inclusionireland.ie/" target="_blank" rel="noopener noreferrer">Inclusion Ireland</a>. Focus on functional life skills, adaptive learning, and community participation. Tailored educational programs are vital.',
                'learning_specific': 'If a specific learning difficulty like Dyslexia is suspected or diagnosed, contact the <a href="https://www.dyslexia.ie/" target="_blank" rel="noopener noreferrer">Dyslexia Association of Ireland</a>. Specialized teaching methods and accommodations (e.g., assistive tech) are important.',
                'communication_speech': 'Prioritize Speech and Language Therapy (SLT) assessment and intervention. Explore Augmentative and Alternative Communication (AAC) if verbal communication is significantly challenging.',
                'physical_mobility': 'Physiotherapy and Occupational Therapy are key. Ensure home and school environments are accessible. The <a href="https://iwa.ie/" target="_blank" rel="noopener noreferrer">Irish Wheelchair Association</a> or <a href="https://www.crc.ie/" target="_blank" rel="noopener noreferrer">Central Remedial Clinic</a> may offer relevant services.',
                'sensory_vision': 'Contact <a href="https://www.ncbi.ie/" target="_blank" rel="noopener noreferrer">NCBI (National Council for the Blind of Ireland)</a> for assessment, mobility training, assistive technology, and educational support.',
                'sensory_hearing': 'Connect with <a href="https://www.chime.ie/" target="_blank" rel="noopener noreferrer">Chime</a> for audiology, communication support (e.g., Irish Sign Language), and hearing technology.',
                'mental_health': 'Seek a referral to Child and Adolescent Mental Health Services (CAMHS) via your GP or CDNT. Explore local youth mental health supports like <a href="https://jigsaw.ie/" target="_blank" rel="noopener noreferrer">Jigsaw</a>.',
                'chronic_illness': 'Work closely with your child’s medical team. Ensure the school has a clear care plan. Connect with support groups specific to the illness (e.g., <a href="https://www.diabetes.ie/" target="_blank" rel="noopener noreferrer">Diabetes Ireland</a>, <a href="https://www.asthma.ie/" target="_blank" rel="noopener noreferrer">Asthma Society</a>).',
                'developmental_delay': 'A comprehensive, multidisciplinary approach via the CDNT is essential for Global Developmental Delay, often involving SLT, OT, and Physiotherapy. Early and consistent intervention is key.',
                'multiple': 'For multiple disabilities/complex needs, a highly coordinated multidisciplinary team approach through the CDNT is crucial. Prioritize needs and explore respite care options if needed.'
            };
            if (disabilityType && disabilityType !== 'unsure' && disabilityType !== 'other' && disabilityActions[disabilityType]) {
                recommendations.add(`Regarding the primary concern of <strong>${primaryConcernText.replace(/\(.*\)/, '').trim()}</strong>: ${disabilityActions[disabilityType]}`);
            } else if (disabilityType === 'other' && disabilityTypeOther) {
                recommendations.add(`For the "Other" primary concern ('${disabilityTypeOther}'), a thorough AON is vital to understand the specific needs. Research organisations related to the symptoms described.`);
            }

            // 4. Specific Challenges
            if (challenges.includes('learning_memory_concentration')) {
                recommendations.add('Discuss an educational psychology assessment with the school/NCSE. Explore strategies for attention, memory, organisation, and consider if assistive technology could help with learning.');
            }
            if (challenges.includes('communication_understanding')) {
                recommendations.add('If not already receiving it, strongly consider a Speech and Language Therapy referral. Visual supports (e.g., PECS, Lámh signs, visual timetables) can aid communication and understanding at home and school.');
            }
            if (challenges.includes('social_interaction')) {
                recommendations.add('Explore social skills groups appropriate for your child\'s age and needs (CDNT or private). Structured playdates and explicit teaching of social cues can be beneficial. For younger children, play therapy could be an option.');
            }
            if (challenges.includes('emotional_regulation')) {
                recommendations.add('Seek strategies for emotional regulation (e.g., Zones of Regulation, 5-Point Scale, calm-down techniques). A child psychologist, play therapist, or OT might offer support. Parenting courses on positive behaviour support can also be helpful.');
            }
            if (challenges.includes('mobility_physical')) {
                recommendations.add('Consult with Physiotherapy and Occupational Therapy for mobility aids, exercises, and strategies to adapt activities and environments. Ensure safety and promote participation.');
            }
            if (challenges.includes('self_care')) {
                recommendations.add('Occupational Therapy can help develop self-care skills (dressing, feeding, toileting) through task breakdown, adaptive equipment, and practice. Visual aids can support learning these routines.');
            }
            if (challenges.includes('sensory_processing')) {
                recommendations.add('An Occupational Therapist with expertise in sensory integration can develop a "sensory diet" and recommend environmental modifications to help your child manage sensory sensitivities or seeking behaviours.');
            }
            if (challenges.includes('play_leisure')) {
                recommendations.add('Explore adapted play activities and inclusive leisure opportunities. Occupational Therapy can suggest ways to modify toys or activities to suit your child\'s abilities and interests. Look for local inclusive clubs or groups.');
            }
            if (challenges.includes('other_challenges') && challengesOtherText) {
                recommendations.add(`Regarding the "Other specific challenges" ('${challengesOtherText}'): Ensure these are clearly detailed during the AON process and to all involved professionals. Research support groups related to these specific issues.`);
            }

            // 5. Current Therapies Status
            if (therapiesStatus === 'no') {
                recommendations.add('Given the concerns, discuss potential therapy needs (e.g., SLT, OT, Physio, Psychology) with your GP and CDNT as part of the AON. Early referral for assessment can be beneficial.');
            } else if (therapiesStatus === 'waiting_list') {
                recommendations.add(`While on waiting lists for: ${therapiesDetailsText || 'therapies'}, actively seek interim supports like parent training programs or online resources from reputable organisations. Maintain contact with the service provider about your place on the list.`);
            } else if (therapiesStatus === 'yes') {
                recommendations.add(`Continue with current therapies (${therapiesDetailsText || 'as specified'}). Ensure regular reviews with therapists to track progress and adjust goals. Share therapy reports (with consent) with the school and other professionals to ensure a coordinated approach.`);
            }

            // 6. Support Sought
            if (additionalSupportSought) {
                let supportSoughtLower = additionalSupportSought.toLowerCase();
                recommendations.add(`Regarding your stated goals of seeking '${additionalSupportSought}': Clearly articulate these to your CDNT case manager or during the AON. They can help identify pathways to achieve these, whether through HSE services, school supports, or community resources.`);
                if (supportSoughtLower.includes("school") || supportSoughtLower.includes("education") || supportSoughtLower.includes("sna")) {
                    recommendations.add("Familiarise yourself with the NCSE's role and processes for requesting school-based supports. Open communication with your child's teacher and principal is essential.");
                }
                if (supportSoughtLower.includes("financial") || supportSoughtLower.includes("allowance") || supportSoughtLower.includes("money")) {
                    recommendations.add(`Review eligibility for schemes like Domiciliary Care Allowance, Carer's Allowance/Benefit, and medical cards on the <a href="https://www.citizensinformation.ie/en/social_welfare/social_welfare_payments/disability_and_illness/" target="_blank" rel="noopener noreferrer">Citizens Information</a> website.`);
                }
                if (supportSoughtLower.includes("respite") || supportSoughtLower.includes("break")) {
                    recommendations.add("Discuss respite care options with your CDNT. Availability varies, but it's an important support for families.");
                }
            }

            // 7. Concluding General Advice
            recommendations.add('<strong>General Next Steps:</strong>');
            recommendations.add('Document everything: keep organised records of all appointments, reports, communications with schools, and HSE services. This "portfolio" is invaluable.');
            recommendations.add('Connect with other parents: Parent support groups (local or national, online or in-person) offer invaluable emotional support, practical advice, and shared experiences. Your CDNT or national disability organisations can provide listings.');
            recommendations.add(`Explore your entitlements: Visit the <a href="https://www.citizensinformation.ie/en/health/disability_and_illness/" target="_blank" rel="noopener noreferrer">Citizens Information website</a> for comprehensive details on supports, rights, and services.`);
            recommendations.add(`This tool is a starting point. <strong>Your primary contact for official assessment and ongoing support coordination is your local <a href="https://www2.hse.ie/services/disability/childrens-services/services/overview/" target="_blank" rel="noopener noreferrer">Children's Disability Network Team (CDNT)</a>.</strong> Use the information gathered here to prepare for your discussions with them.`);


            Array.from(recommendations).forEach(rec => {
                const li = document.createElement('li');
                li.innerHTML = rec; // Using innerHTML because rec can contain HTML links
                resultsList.appendChild(li);
            });
        }


        function enableResultsTab() {
            if (navResultsLink) {
                navResultsLink.classList.remove('nav-disabled');
                navResultsLink.setAttribute('aria-disabled', 'false');
                navResultsLink.setAttribute('aria-label', 'View Assessment Results');
                // Restore original click behavior only if it exists
                if (typeof navResultsLink.originalOnClick === 'function') {
                    navResultsLink.onclick = navResultsLink.originalOnClick;
                } else {
                     navResultsLink.onclick = (event) => showSection('results', navResultsLink); // Default if original not stored
                }

            }
        }
        function disableResultsTab() {
            if (navResultsLink) {
                navResultsLink.classList.add('nav-disabled');
                navResultsLink.setAttribute('aria-disabled', 'true');
                navResultsLink.setAttribute('aria-label', 'View Assessment Results (Complete assessment first)');
                // Store original onclick if it's not already the disabled handler
                if (!navResultsLink.originalOnClick && navResultsLink.onclick && navResultsLink.onclick.toString().indexOf("alert") === -1) {
                     navResultsLink.originalOnClick = navResultsLink.onclick;
                }
                // Prevent navigation if disabled
                navResultsLink.onclick = (event) => {
                    event.preventDefault();
                    alert("Please complete and submit the assessment form to view results.");
                    showSection('assessment', document.querySelector('nav a[href="#assessment"]'));
                };
            }
        }

        // --- PRINT FUNCTIONALITY ---
        function printResults() {
            const resultsSection = document.getElementById('results');
            if (!resultsSection) return;

            // Create a temporary printable version
            const printableArea = document.createElement('div');
            printableArea.innerHTML = `
                <style>
                    @media print {
                        body { font-family: Arial, sans-serif; margin: 20px !important; color: #333 !important; background-color: #fff !important; }
                        h1, h2, h3 { color: #0055a4 !important; }
                        .disclaimer-box { border: 1px solid #d32f2f !important; padding: 10px !important; margin-bottom:15px !important; background-color: #ffebee !important; color: #c62828 !important;}
                        .disclaimer-box strong { color: #d32f2f !important; }
                        ul.resources { list-style-type: disc !important; padding-left: 20px !important; }
                        ul.resources li { margin-bottom: 8px !important; }
                        ul.resources li::before { content: '' !important; } /* Hide custom bullet for print */
                        a { color: #0055a4 !important; text-decoration: none !important; }
                        a[href]:after { content: " (" attr(href) ")"; font-size: 0.8em; color: #555; } /* Show URLs for links */
                        .button-group, nav, .header-controls, #theme-toggle, footer#original-footer, header#original-header { display: none !important; }
                        header.print-header h1 { text-align: center !important; font-size: 1.5em !important; margin-bottom: 10px !important;}
                        footer.print-footer { text-align: center !important; font-size: 0.8em !important; color: #555 !important; margin-top: 20px !important; border-top: 1px solid #ccc !important; padding-top: 10px !important;}
                        #results-summary p { margin-bottom: 0.5em !important; }
                        #results-summary strong { display: inline-block !important; min-width: 150px !important; font-weight: bold !important;}
                        main { max-width: 100% !important; margin: 0 !important; padding: 0 !important; }
                        section#results { box-shadow: none !important; border: none !important; padding: 0 !important; }
                        /* Remove any dark mode styles that might interfere */
                        body.dark-mode { background-color: #fff !important; color: #333 !important; }
                        .dark-mode h2, .dark-mode h3 { color: #0055a4 !important; }
                        .dark-mode ul.resources li::before { color: #0055a4 !important; }
                    }
                </style>
                <header class="print-header"><h1>Children's Disability Needs Assessment - Preliminary Insights</h1></header>
                <hr>
                ${resultsSection.innerHTML}
                <hr>
                <footer class="print-footer"><p>© ${new Date().getFullYear()} Children's Disability Needs Assessment Prototype. For official support, visit HSE Disability Services.</p></footer>
            `;

            const originalBodyHTML = document.body.innerHTML;
            const originalBodyClass = document.body.className;

            document.body.innerHTML = printableArea.innerHTML;
            document.body.className = ''; // Remove dark-mode class for printing if active

            window.print();

            document.body.innerHTML = originalBodyHTML;
            document.body.className = originalBodyClass; // Restore original classes

            // Re-initialize necessary elements and event listeners
            // This is crucial because replacing innerHTML destroys existing DOM references and listeners.
            assessmentForm = document.getElementById(ASSESSMENT_FORM_ID);
            progressBar = document.getElementById('progress-bar');
            themeToggleButton = document.getElementById('theme-toggle');
            navResultsLink = document.getElementById('nav-results');

            if (assessmentForm) {
                childAgeInput = document.getElementById('child-age');
                diagnosisSelect = document.getElementById('diagnosis');
                diagnosisDetailsContainer = document.getElementById('diagnosis-details-container');
                diagnosisDetailsInput = document.getElementById('diagnosis-details');
                disabilityTypeSelect = document.getElementById('disability-type');
                disabilityTypeOtherContainer = document.getElementById('disability-type-other-container');
                disabilityTypeOtherText = document.getElementById('disability-type-other-text');
                challengesCheckboxes = assessmentForm.querySelectorAll('input[name="challenges"]');
                challengesOtherCheckbox = assessmentForm.querySelector('input[name="challenges"][value="other_challenges"]');
                challengesOtherContainer = document.getElementById('challenges-other-container');
                challengesOtherText = document.getElementById('challenges-other-text');
                therapiesSelect = document.getElementById('therapies');
                therapiesDetailsContainer = document.getElementById('therapies-details-container');
                therapiesDetailsText = document.getElementById('therapies-details-text');
                requiredFields = Array.from(assessmentForm.querySelectorAll('[required]'));
            }
            document.getElementById('current-year').textContent = new Date().getFullYear();


            initializeState(); // Re-apply theme, load form data, update progress bar, dynamic fields
            setupEventListeners(); // Re-attach all event listeners

            // Restore the active section.
            const activeNav = document.querySelector('nav a.active-nav');
            const activeSectionId = activeNav ? activeNav.getAttribute('href').substring(1) : 'home';
            showSection(activeSectionId, activeNav || document.querySelector('nav a[href="#home"]'));
        }

    </script>
</body>
</html>
